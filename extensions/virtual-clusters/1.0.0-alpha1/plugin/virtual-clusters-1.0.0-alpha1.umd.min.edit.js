(("undefined"!==typeof self?self:this)["webpackChunkvirtual_clusters_1_0_0_alpha1"]=("undefined"!==typeof self?self:this)["webpackChunkvirtual_clusters_1_0_0_alpha1"]||[]).push([[739],{8075:function(e,t,o){"use strict";o.r(t);var a=o(40429),s=o.n(a),l=o(1214),i=o.n(l),n=i()(s());n.push([e.id,".headers[data-v-ca091f6c]{display:flex;flex-direction:row;justify-content:space-evenly;align-items:center;border-bottom:1px solid var(--border);height:30px;width:calc(100% - 75px)}.headers div[data-v-ca091f6c]{width:100%}",""]),t["default"]=n},22e3:function(e,t,o){var a=o(70864);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=o(74825).A;s("b0f8a37c",a,!0,{sourceMap:!1,shadowMode:!1})},40743:function(e,t,o){"use strict";o.r(t);var a=o(40429),s=o.n(a),l=o(1214),i=o.n(l),n=i()(s());n.push([e.id,".project-select[data-v-2b7a7a50] .vs__selected{width:-moz-fit-content!important;width:fit-content!important}[data-v-2b7a7a50] .project-modal{padding:20px}.project-modal-footer[data-v-2b7a7a50]{float:right;overflow:hidden;padding:20px}",""]),t["default"]=n},41246:function(e,t,o){"use strict";o.r(t);var a=o(40429),s=o.n(a),l=o(1214),i=o.n(l),n=i()(s());n.push([e.id,".row[data-v-4d5b26d1]{display:flex;flex-direction:row;justify-content:space-evenly}",""]),t["default"]=n},52122:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return xe}});var a=o(9274);const s={class:"row mb-20"},l={class:"col span-12"},i={class:"row mb-10"},n={class:"col span-12"},r={"aria-label":"link to the K3K github repository",href:"https://github.com/rancher/k3k/blob/main/docs/virtualclusterpolicy.md#4-managing-network-isolation-disablenetworkpolicy",target:"_blank",rel:"noopener noreferrer nofollow"},c={class:"row mb-20"},d={class:"col span-6"},p={class:"row mb-10"},u={class:"col span-12"},m={class:"row mb-20"},h={class:"col span-6"},y={class:"row mb-10"},v={class:"col span-12"},k={class:"row mb-20"},f={class:"col span-6 vertical-checkboxes"};function g(e,t,o,g,b,N){const j=(0,a.resolveComponent)("Loading"),S=(0,a.resolveComponent)("NameNsDescription"),E=(0,a.resolveComponent)("Projects"),C=(0,a.resolveComponent)("Mode"),P=(0,a.resolveComponent)("Tab"),w=(0,a.resolveComponent)("ContainerResourceLimit"),B=(0,a.resolveComponent)("t"),V=(0,a.resolveComponent)("KeyValue"),A=(0,a.resolveComponent)("LabeledSelect"),_=(0,a.resolveComponent)("Checkbox"),x=(0,a.resolveComponent)("Tabbed"),M=(0,a.resolveComponent)("CruResource");return e.$fetchState.pending?((0,a.openBlock)(),(0,a.createBlock)(j,{key:0})):((0,a.openBlock)(),(0,a.createBlock)(M,{key:1,mode:e.mode,resource:e.value,errors:e.fvUnreportedValidationErrors,"validation-passed":e.fvFormIsValid,"component-testid":"cluster-explorer-virtual-cluster-policy","cancel-event":!0,onFinish:N.saveOverride,onError:t[8]||(t[8]=t=>e.errors=t),onCancel:e.cancel},{default:(0,a.withCtx)((()=>[e.isView?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)(S,{key:0,mode:e.mode,namespaced:!1,value:e.value,"create-namespace-override":!0},null,8,["mode","value"])),(0,a.createVNode)(x,{"side-tabs":!0},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(P,{weight:4,name:"config","label-key":"k3k.policy.tabs.config"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(E,{ref:"project-selector",errors:b.projectAnnotationErrors,"onUpdate:errors":t[0]||(t[0]=e=>b.projectAnnotationErrors=e),mode:e.mode,policy:e.value,"onUpdate:selectedProjects":N.updateSelectedProjects,onFinish:e.done},null,8,["errors","mode","policy","onUpdate:selectedProjects","onFinish"]),(0,a.createVNode)(C,{"k3k-mode":e.value.spec.allowedMode,"onUpdate:k3kMode":t[1]||(t[1]=t=>e.value.spec.allowedMode=t),mode:e.mode},null,8,["k3k-mode","mode"])])),_:1}),(0,a.createVNode)(P,{weight:3,name:"resources","label-key":"k3k.policy.tabs.resourceAllocation"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.headers.quotas")),1),(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.headers.resourceLimits")),1),(0,a.createVNode)(w,{value:N.defaultLimits,"onUpdate:value":t[2]||(t[2]=e=>N.defaultLimits=e),mode:e.mode,namespace:e.value,"register-before-hook":e.registerBeforeHook,"data-testid":"namespace-container-resource-limit"},null,8,["value","mode","namespace","register-before-hook"])])),_:1}),(0,a.createVNode)(P,{weight:2,name:"advanced","label-key":"k3k.policy.tabs.advanced"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",s,[(0,a.createElementVNode)("div",l,[(0,a.createVNode)(V,{value:e.value.spec.defaultNodeSelector,"onUpdate:value":t[3]||(t[3]=t=>e.value.spec.defaultNodeSelector=t),"initial-empty-row":!0,mode:e.mode,"read-allowed":!1,title:e.t("k3k.nodeSelector.label"),"add-label":e.t("k3k.nodeSelector.addLabel")},{title:(0,a.withCtx)((()=>[(0,a.createElementVNode)("h4",null,(0,a.toDisplayString)(e.t("k3k.nodeSelector.label")),1),(0,a.createVNode)(B,{raw:"",k:"k3k.nodeSelector.tooltip"})])),_:1},8,["value","mode","title","add-label"])])]),(0,a.createElementVNode)("div",i,[(0,a.createElementVNode)("div",n,[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.security.label")),1),(0,a.createVNode)(B,{k:"k3k.policy.security.tooltip",raw:""}),(0,a.createElementVNode)("a",r,[(0,a.createVNode)(B,{k:"k3k.policy.security.learnMore",raw:""}),t[9]||(t[9]=(0,a.createElementVNode)("i",{class:"icon icon-sm icon-external-link"},null,-1))])])]),(0,a.createElementVNode)("div",c,[(0,a.createElementVNode)("div",d,[(0,a.createVNode)(A,{value:e.value.spec.podSecurityAdmissionLevel,"onUpdate:value":t[4]||(t[4]=t=>e.value.spec.podSecurityAdmissionLevel=t),options:["privileged","baseline","restricted"],label:e.t("cluster.rke2.defaultPodSecurityAdmissionConfigurationTemplateName.label")},null,8,["value","label"])])]),(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("div",u,[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.isolation.label")),1),(0,a.createVNode)(B,{k:"k3k.policy.isolation.tooltip",raw:""})])]),(0,a.createElementVNode)("div",m,[(0,a.createElementVNode)("div",h,[(0,a.createVNode)(_,{value:e.value.spec.disableNetworkPolicy,"onUpdate:value":t[5]||(t[5]=t=>e.value.spec.disableNetworkPolicy=t),mode:e.mode,label:e.t("k3k.policy.isolation.checkbox")},null,8,["value","mode","label"])])]),(0,a.createElementVNode)("div",y,[(0,a.createElementVNode)("div",v,[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.synchronization.label")),1),(0,a.createVNode)(B,{k:"k3k.policy.synchronization.tooltip",raw:""})])]),(0,a.createElementVNode)("div",k,[(0,a.createElementVNode)("div",f,[(0,a.createVNode)(_,{value:e.value?.spec?.sync?.ingresses?.enabled,mode:e.mode,label:e.t("k3k.policy.synchronization.ingressCheckbox"),"onUpdate:value":t[6]||(t[6]=e=>N.updateSync("ingresses",e))},null,8,["value","mode","label"]),(0,a.createVNode)(_,{value:e.value?.spec?.sync?.priorityClasses?.enabled,mode:e.mode,label:e.t("k3k.policy.synchronization.priorityClassCheckbox"),"onUpdate:value":t[7]||(t[7]=e=>N.updateSync("priorityClasses",e))},null,8,["value","mode","label"])])])])),_:1}),(0,a.createVNode)(P,{weight:1,name:"labels","label-key":"generic.labelsAndAnnotations"})])),_:1})])),_:1},8,["mode","resource","errors","validation-passed","onFinish","onCancel"]))}var b=o(91468),N=o(43067),j=o(56e3),S=o(74913),E=o(55588),C=o(74405),P=o(89860),w=o(13509),B=o(31901),V=o(77614),A=o(98066),_=o(34242),x=o(10379),M=o(72774),D=o(59072);var I=o(87061);const L={key:0,class:"row"};function O(e,t,o,s,l,i){const n=(0,a.resolveComponent)("Select"),r=(0,a.resolveComponent)("UnitInput");return e.typeOption?((0,a.openBlock)(),(0,a.createElementBlock)("div",L,[(0,a.createVNode)(n,{value:o.type,class:"mr-10",mode:o.mode,options:o.types,"onUpdate:value":t[0]||(t[0]=e=>i.updateType(e))},null,8,["value","mode","options"]),(0,a.createVNode)(r,{value:i.resourceQuotaLimit[o.type],class:"mr-10",mode:o.mode,placeholder:e.typeOption.placeholder,increment:e.typeOption.increment,"input-exponent":e.typeOption.inputExponent,"base-unit":e.typeOption.baseUnit,"output-modifier":!0,"onUpdate:value":t[1]||(t[1]=e=>i.updateQuotaLimit(o.type,e))},null,8,["value","mode","placeholder","increment","input-exponent","base-unit"])])):(0,a.createCommentVNode)("",!0)}var T=o(154),U=o(58606),$={emits:["type-change"],components:{Select:T.A,UnitInput:U.A},props:{mode:{type:String,required:!0},types:{type:Array,default:()=>[]},type:{type:String,default:""},value:{type:Object,default:()=>({})}},computed:{...V.H0,resourceQuotaLimit:{get(){return this.value.spec.resourceQuota?.limit||{}}},namespaceDefaultResourceQuotaLimit:{get(){return this.value.spec.namespaceDefaultResourceQuota?.limit||{}}}},methods:{updateType(e){"undefined"!==typeof this.value.spec.resourceQuota?.limit[this.type]&&delete this.value.spec.resourceQuota.limit[this.type],"undefined"!==typeof this.value.spec.namespaceDefaultResourceQuota?.limit[this.type]&&delete this.value.spec.namespaceDefaultResourceQuota.limit[this.type],this.$emit("type-change",e)},updateQuotaLimit(e,t,o){}}},Y=(o(74590),o(47433));const q=(0,Y.A)($,[["render",O],["__scopeId","data-v-4d5b26d1"]]);var Q=q;I.A,V.dz,o(59083);const R={class:"row mb-20"},z={class:"col span-6"},F={class:"project-modal-footer"},G={key:0,class:"text-muted"};function K(e,t,o,s,l,i){const n=(0,a.resolveComponent)("LabeledSelect"),r=(0,a.resolveComponent)("ProjectTable"),c=(0,a.resolveComponent)("AppModal");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("h3",null,(0,a.toDisplayString)(e.t("k3k.policy.headers.projectsAndNamespaces")),1),(0,a.createElementVNode)("h5",null,(0,a.toDisplayString)(e.t("k3k.policy.projects.subheader")),1),(0,a.createElementVNode)("div",R,[(0,a.createElementVNode)("div",z,[(0,a.createVNode)(n,{value:l.selectedProjects,"onUpdate:value":t[0]||(t[0]=e=>l.selectedProjects=e),label:e.t("k3k.policy.projects.label"),class:"project-select",mode:o.mode,options:i.projectOptions,multiple:""},null,8,["value","label","mode","options"])])]),l.displayProjects.length&&!i.isCreate?((0,a.openBlock)(),(0,a.createBlock)(r,{key:0,"deselected-projects":l.deselectedProjects,"display-projects":l.displayProjects,"policy-name":o.policy?.metadata?.name,mode:o.mode},null,8,["deselected-projects","display-projects","policy-name","mode"])):(0,a.createCommentVNode)("",!0),l.showModal?((0,a.openBlock)(),(0,a.createBlock)(c,{key:1,name:"assign-policies","click-to-close":!1,class:"project-modal"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(r,{ref:"modal-table","is-in-modal":!0,"deselected-projects":l.deselectedProjects,"display-projects":[...l.selectedProjects,...l.deselectedProjects],"policy-name":o.policy?.metadata?.name,"done-saving-namespaces":l.doneSavingNamespaces,"namespaces-saved":l.namespacesSaved,mode:o.mode},null,8,["deselected-projects","display-projects","policy-name","done-saving-namespaces","namespaces-saved","mode"]),(0,a.createElementVNode)("div",F,[l.doneSavingNamespaces?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("span",G,[t[3]||(t[3]=(0,a.createElementVNode)("i",{class:"icon icon-spin icon-spinner"},null,-1)),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.t("k3k.policy.projects.savingNamespaces")),1)])),l.doneSavingNamespaces&&l.hasErrors?((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:1,class:"btn role-secondary",onClick:t[1]||(t[1]=e=>o.policy.goToEdit())}," Edit Policy ")):(0,a.createCommentVNode)("",!0),l.doneSavingNamespaces?((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:2,class:"btn role-primary",onClick:t[2]||(t[2]=t=>e.$emit("finish"))},(0,a.toDisplayString)(e.t("generic.done")),1)):(0,a.createCommentVNode)("",!0)])])),_:1})):(0,a.createCommentVNode)("",!0)])}var W=o(87290),J=o(22625),H=o(56568),X=o(53922),Z=o(32850),ee=o(93683),te=o(16414);const oe={class:"row mb-20"},ae={class:"col span-12"},se={class:"ns"},le={class:"status"},ie={key:0,class:"text-error"},ne={key:0,class:"ns"},re={key:1,class:"ns"},ce={class:"status"},de={key:0,class:"icon icon-error text-error"},pe={key:2,class:"icon icon-checkmark text-success"},ue={key:3,class:"icon icon-checkmark text-muted"},me={key:4,class:"icon icon-refresh text-warning"};function he(e,t,o,s,l,i){const n=(0,a.resolveComponent)("Banner"),r=(0,a.resolveDirective)("clean-tooltip");return(0,a.openBlock)(),(0,a.createElementBlock)("div",oe,[(0,a.createElementVNode)("div",ae,[e.showSuccessBanner?((0,a.openBlock)(),(0,a.createBlock)(n,{key:0,color:"success",label:e.t("k3k.policy.projects.table.successBanner")},null,8,["label"])):i.showErrorBanner?((0,a.openBlock)(),(0,a.createBlock)(n,{key:1,color:"error",label:e.t("k3k.policy.projects.table.errorBanner")},null,8,["label"])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("table",{class:(0,a.normalizeClass)(["project-annotation-status",{"in-modal":o.isInModal}])},[(0,a.createElementVNode)("tr",null,[(0,a.createElementVNode)("th",null,(0,a.toDisplayString)(e.t("k3k.policy.projects.table.projects")),1),(0,a.createElementVNode)("th",se,(0,a.toDisplayString)(e.t("k3k.policy.projects.table.namespaces")),1),(0,a.createElementVNode)("th",le,(0,a.toDisplayString)(e.t("k3k.policy.projects.table.status")),1)]),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.statuses,(({willSave:t,saved:s,errMsg:l,project:i,showDeselectIcon:n,showSuccessIcon:c})=>((0,a.openBlock)(),(0,a.createElementBlock)("tr",{key:i.id},[(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("div",null,(0,a.toDisplayString)(i.nameDisplay),1),l?((0,a.openBlock)(),(0,a.createElementBlock)("span",ie,(0,a.toDisplayString)(l),1)):(0,a.createCommentVNode)("",!0)]),n&&o.isInModal?((0,a.openBlock)(),(0,a.createElementBlock)("td",ne,(0,a.toDisplayString)(t.length-s.length)+"/"+(0,a.toDisplayString)(t.length),1)):((0,a.openBlock)(),(0,a.createElementBlock)("td",re,(0,a.toDisplayString)(s.length)+"/"+(0,a.toDisplayString)(t.length),1)),(0,a.createElementVNode)("td",ce,[(0,a.createElementVNode)("div",null,[l?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("i",de,null,512)),[[r,e.t("k3k.policy.projects.table.errorTooltip")]]):n?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("i",{key:1,class:(0,a.normalizeClass)(["icon icon-trash",{"text-error":!e.inModal||o.doneSavingNamespaces,"text-muted":e.inModal&&!o.doneSavingNamespaces}])},null,2)),[[r,e.t("k3k.policy.projects.table.deselectedTooltip")]]):c?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("i",pe,null,512)),[[r,e.t("k3k.policy.projects.table.successTooltip")]]):o.isInModal&&!o.doneSavingNamespaces?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("i",ue,null,512)),[[r,e.t("k3k.policy.projects.table.selectedTooltip")]]):o.isInModal?(0,a.createCommentVNode)("",!0):(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("i",me,null,512)),[[r,e.t("k3k.policy.projects.table.errorTooltip")]])])])])))),128))],2)])])}var ye=o(97305),ve={name:"K3kProjectNSAnnotationStatus",props:{mode:{type:String,default:W.YQ},selectedProjects:{type:Array,default:()=>[]},deselectedProjects:{type:Array,default:()=>[]},displayProjects:{type:Array,default:()=>[]},policyName:{type:String,default:""},isInModal:{type:Boolean,default:!1},namespacesSaved:{type:Array,default:()=>[]},doneSavingNamespaces:{type:Boolean,default:!1}},components:{Banner:ye.Banner},created(){this.computeAllStatuses()},watch:{displayProjects(){this.isInModal||(this.statuses={},this.computeAllStatuses())},deselectedProjects(){this.isInModal||this.computeAllStatuses()}},data(){return{statuses:{}}},computed:{showErrorBanner(){return!!(Object.values(this.statuses)||[]).find((e=>e?.hasServerErrors||e?.hasPermissionErrors))}},methods:{computeNamespaceStatus(e={},t=[]){const o=e.namespaces||[],a=o.filter((e=>!!e?.__policyServerError))?.length,s=o.filter((e=>!!e?.__policyPermissionError))?.length,l=o.filter((e=>{if(this.isInModal)return this.namespacesSaved.includes(e.id);const t=e?.__policyPermissionError||e?.__policyServerError;return e?.metadata?.annotations?.[te.B.POLICY]===this.policyName&&!t})),i=!s&&!a&&o.length===l.length,n=this.deselectedProjects.find((t=>t.id===e.id));let r;s?r=this.t("k3k.policy.projects.table.errors.permission"):(a||o.length!==l.length&&(this.doneSavingNamespaces||!this.isInModal))&&(r=this.t("k3k.policy.projects.table.errors.server")),this.statuses[e.id]={project:e,willSave:o,saved:l,showDeselectIcon:n,showSuccessIcon:i,errMsg:r}},computeAllStatuses(){this.displayProjects.forEach((e=>this.computeNamespaceStatus(e)))}}};o(96637);const ke=(0,Y.A)(ve,[["render",he],["__scopeId","data-v-a3700e2e"]]);var fe=ke,ge=o(65359),be=o(63375),Ne=o.n(be),je=o(38221),Se=o.n(je),Ee=o(4364);const Ce=200;var Pe={name:"K3kPolicyProjectSelect",emits:["update:errors","update:projectAnnotation","update:selectedProjects","finish"],props:{mode:{type:String,default:W.YQ},policy:{type:Object,default:()=>{}},errors:{type:Array,default:()=>[]}},async fetch(){this.mode!==W.YQ&&await this.$store.dispatch("cluster/findAll",{type:"namespace"})},created(){this.findSelectedProjects(),this.denouncedUpdateNotification=Se()(this.updateNotification,50)},components:{LabeledSelect:x.A,ProjectTable:fe,AppModal:ee.h},data(){return{showModal:!1,doneSavingNamespaces:!1,hasErrors:!1,namespacesSaved:[],selectedProjects:[],deselectedProjects:[],displayProjects:[],denouncedUpdateNotification:()=>{}}},watch:{selectedProjects(e=[],t=[]){this.$emit("update:selectedProjects",e);const o=t.filter((t=>!e.find((e=>e.id===t.id))));if(o){const e=o.filter((e=>{const t=e.namespaces||[];return!!t.find((e=>e?.metadata?.annotations[te.B.POLICY]&&e?.metadata?.annotations[te.B.POLICY]===this.policy?.metadata?.name))}));e.forEach((e=>{this.deselectedProjects.find((t=>t.id===e.id))||(this.deselectedProjects.push(e),this.displayProjects.find((t=>t.id===e.id))||this.displayProjects.push(e))}))}this.deselectedProjects=this.deselectedProjects.filter((t=>!e.find((e=>e.id===t.id)))),e.forEach((e=>{const t=e.namespaces||[],o=t.filter((e=>e?.metadata?.annotations[te.B.POLICY]&&e?.metadata?.annotations[te.B.POLICY]===this.policy?.metadata?.name)),a=o.length!==t.length;a||(this.displayProjects=this.displayProjects.filter((t=>t.id!==e.id)))}))}},methods:{findSelectedProjects(){const e=(this.policy?.metadata?.annotations?.[te.B.POLICY_ASSIGNED_TO]||"").split(",").map((e=>e.trim()));e.length||(this.selectedProjects=[]);const t=e.map((e=>this.$store.getters["management/byId"](X.Mc.PROJECT,e)));this.selectedProjects=t.filter((e=>e&&e.id)),this.displayProjects=this.selectedProjects.filter((e=>{const t=e.namespaces||[];return t.find((e=>e?.metadata?.annotations?.[te.B.POLICY]!==this.policy?.metadata?.name||e.__policyPermissionError||e.__policyServerError))}))},saveNamespaceLite(e={}){if(!e.metadata?.name)return;const t=`/k8s/clusters/${this.currentCluster.id}/v1/namespaces/${e.metadata.name}`;return this.$store.dispatch("cluster/request",{url:t,method:"PUT",data:e.cleanForSave(JSON.parse(JSON.stringify(e)))})},async annotateAndSaveNamespaces(){let e=0,t=0;const o=[],a=this.namespacesSaved,s=[],l=[],i=[],n=(0,J.vx)(),r=`${this.policy?.metadata?.name}`,c={...this.policy?.detailLocation||{},query:{[W.g]:W.G5,[W.AS]:W.xz}},d=this.$router.resolve(c)?.fullPath;this.selectedProjects.forEach((t=>{const s=t.namespaces||[];s.forEach((t=>{e++,t?.metadata?.annotations?.[te.B.POLICY]!==this.policy?.metadata?.name||t.__policyPermissionError||t.__policyServerError?(o.push(t),t.setAnnotation(te.B.POLICY,this.policy?.metadata?.name)):a.push(t.id)}))})),this.deselectedProjects.forEach((e=>{const s=e.namespaces||[];s.forEach((e=>{t++,e?.metadata?.annotations?.[te.B.POLICY]===this.policy?.metadata?.name||e.__policyPermissionError||e.__policyServerError?(o.push(e),e.setAnnotation(te.B.POLICY,null)):a.push(e.id)}))})),this.showModal=o?.length>Ce;const p=o=>new Promise(((c,p)=>{this.saveNamespaceLite(o).then((()=>{a.push(o.id),o.__policyServerError=!1,o.__policyPermissionError=!1,this.showModal?this.updateModalTable(o.project,a):this.denouncedUpdateNotification({toBeAssignedCount:e,toBeUnAssssignedCount:t,nsSaved:a,nsErrored:s,projectsWithServerErrors:l,projectsWithPermissionErrors:i,policyName:r,editPath:d,notificationID:n}),c()})).catch((p=>{s.push(o.id),o.__policyServerError=!0,this.hasErrors=!0;const u=o?.project?.nameDisplay;u&&!l.includes(u)&&l.push(u),this.showModal?this.updateModalTable(o.project,a):this.denouncedUpdateNotification({toBeAssignedCount:e,toBeUnAssssignedCount:t,nsSaved:a,nsErrored:s,projectsWithServerErrors:l,projectsWithPermissionErrors:i,policyName:r,editPath:d,notificationID:n}),c()}))}));try{await Promise.all(o.map((e=>p(e)))),this.doneSavingNamespaces=!0}catch(u){throw this.showModal||this.$emit("finish"),this.doneSavingNamespaces=!0,Ee.log("***** CATCH this is after the promise dot all"),u}this.showModal||this.$emit("finish"),this.doneSavingNamespaces=!0},updateModalTable(e={},t){const o=this.$refs["modal-table"];o&&o.computeNamespaceStatus(e,t)},updateNotification({toBeAssignedCount:e=0,toBeUnAssssignedCount:t=0,nsSaved:o=[],nsErrored:a=[],projectsWithServerErrors:s=[],projectsWithPermissionErrors:l=[],policyName:i="",editPath:n,notificationID:r,addAnnotation:c=!0}){const d=e+t;if(!d)return;const p=c?"k3k.policy.projects.notification.adding":"k3k.policy.projects.notification.removing";let u=Z.S.Task,m=this.t(`${p}.task.title`),h=this.t(`${p}.task.message`,{namespaceCount:d,policyName:i}),y=null;const v=d===a?.length+o?.length,k=!!a?.length,f=v&&!k,g=Math.round(o.length/d*100);if(v)if(f)u=Z.S.Success,m=this.t(`${p}.success.title`),h=this.t(`${p}.success.message`,{namespaceCount:o.length,policyName:i});else{const e=Ne()([...s,...l]);u=Z.S.Error,m=this.t(`${p}.error.title`),h=this.t(`${p}.error.message`,{failCount:e.length,policyName:i}),e.forEach((t=>{const o=e[e.length-1]===t;1===e.length?h+=` ${t}.`:h+=o?`${this.t("generic.and")}${t}.`:` ${t},`})),e.length&&(y={label:this.t("k3k.policy.projects.notification.secondaryAction"),route:n})}let b="notifications/update";this.notified||(b="notifications/add"),this.$store.dispatch(b,{level:u,title:m,message:h,progress:v?void 0:g,primaryAction:y,id:r}),this.notified=!0}},computed:{...(0,ge.L8)({t:"i18n/t",currentCluster:"currentCluster"}),isCreate(){return this.mode===W.YQ},allProjects(){return this.$store.getters["management/all"]({type:X.Mc.PROJECT})},projectOptions(){return(0,H.Ul)(this.allProjects.map((e=>({label:e?.spec?.displayName,value:e}))),"label")}}};o(90695);const we=(0,Y.A)(Pe,[["render",K],["__scopeId","data-v-2b7a7a50"]]);var Be=we;const Ve="container";var Ae={name:"CRUClusterPolicy",mixins:[E.A,C.A],components:{CruResource:b.A,Loading:N.A,NameNsDescription:B.A,Mode:S.A,Tabbed:w.A,Tab:P.A,Labels:j.A,ContainerResourceLimit:A.A,KeyValue:_.A,LabeledSelect:x.A,Projects:Be,Checkbox:M.A},async fetch(){this.value.spec||(this.value.spec={})},data(){return{projectAnnotationErrors:[]}},computed:{quotaTypes(){return V.Sg},defaultLimits:{get(){const e=(this.value?.spec?.limit?.limits||[]).find((e=>e.type===Ve))||{},{max:t={},defaultRequest:o={}}=e;return{limitsCpu:t.cpu,limitsMemory:t.memory,limitsGpu:t.gpu,requestsCpu:o.cpu,requestsMemory:o.memory}},set({limitsCpu:e,limitsMemory:t,requestsCpu:o,requestsMemory:a,limitsGpu:s}){this.value.spec.limit||(this.value.spec.limit={}),this.value.spec.limit.limits||(this.value.spec.limit.limits=[]);const l={type:Ve,max:{},defaultRequest:{}};void 0!==e&&(l.max.cpu=e),void 0!==t&&(l.max.memory=t),void 0!==o&&(l.defaultRequest.cpu=o),void 0!==a&&(l.defaultRequest.memory=a),void 0!==s&&(l.max.gpu=s),this.value.spec.limit.limits=[l]}},quota:{get(){return this.value?.spec?.quota?.hard||{}},set(e={}){this.value.spec.quota={hard:e}}}},methods:{updateSelectedProjects(e=[]){e.length?this.value.setAnnotation([te.B.POLICY_ASSIGNED_TO],e.map((e=>e.id)).join(", ")):this.value.setAnnotation([te.B.POLICY_ASSIGNED_TO],"")},updateSync(e,t){this.value.spec.sync||(this.value.spec.sync={}),this.value.spec.sync[e]?this.value.spec.sync[e].enabled=t:this.value.spec.sync[e]={enabled:t}},async saveOverride(e,t){try{await this.actuallySave();const t=this.$refs["project-selector"];t?await t.annotateAndSaveNamespaces():e(!0)}catch(o){const a=409===o.status||409===o._status;if(a&&0===t&&this.isEdit){const o=await this.conflict();if(!1===o)return this.saveOverride(e,t+1);this.errors=o}else this.errors=(0,D.rz)(o);e&&e(!1)}}}};o(22e3);const _e=(0,Y.A)(Ae,[["render",g]]);var xe=_e},59083:function(e,t,o){var a=o(8075);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=o(74825).A;s("2cfe6cef",a,!0,{sourceMap:!1,shadowMode:!1})},62749:function(e,t,o){"use strict";o.r(t);var a=o(40429),s=o.n(a),l=o(1214),i=o.n(l),n=i()(s());n.push([e.id,".project-annotation-status[data-v-a3700e2e]{width:100%;border-collapse:separate}.project-annotation-status.in-modal[data-v-a3700e2e]{padding:20px}.project-annotation-status td[data-v-a3700e2e],.project-annotation-status th[data-v-a3700e2e]{text-align:left;padding:5px}.project-annotation-status tr:not(:last-of-type) td[data-v-a3700e2e]{border-bottom:1px dashed var(--border)}.project-annotation-status td.ns[data-v-a3700e2e]{width:12em}.project-annotation-status td.status[data-v-a3700e2e]{min-width:35px}",""]),t["default"]=n},70864:function(e,t,o){"use strict";o.r(t);var a=o(40429),s=o.n(a),l=o(1214),i=o.n(l),n=i()(s());n.push([e.id,".vertical-checkboxes{display:flex;flex-direction:column}",""]),t["default"]=n},74590:function(e,t,o){var a=o(41246);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=o(74825).A;s("5cbb6d6e",a,!0,{sourceMap:!1,shadowMode:!1})},90695:function(e,t,o){var a=o(40743);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=o(74825).A;s("334bd2ad",a,!0,{sourceMap:!1,shadowMode:!1})},96637:function(e,t,o){var a=o(62749);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=o(74825).A;s("10cd1cf9",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=virtual-clusters-1.0.0-alpha1.umd.min.edit.js.map